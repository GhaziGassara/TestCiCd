name: .NET

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
 
jobs: 
  build-and-deploy: 
    runs-on: self-hosted
    steps: 
      - 
        uses: actions/checkout@v2
      - 
        name: "Setup .NET Core"
        uses: actions/setup-dotnet@v1
        with: 
          dotnet-version: "3.0.1"
      - 
        name: "Build with dotnet"
        run: "dotnet build --configuration Release .\\TestCiCd"
      - 
        name: "dotnet publish"
        run: "dotnet publish -c Release -o TestCiCd .\\TestCiCd\n"
      - 
        name: "Deploy to IIS"
        run: |
            iisreset /stop
            Copy-Item ./TestCiCd/* C:/inetpub/wwwroot/dotnetcore-webapp -Recurse -Force
            iisreset /start
      - 
        name: "Curl the website as a smoke test"
        run: "curl http://localhost/dotnetcore-webapp"
